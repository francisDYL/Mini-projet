<!DOCTYPE html>
<html lang="en" ng-app="myApp" >
<head>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
        
        <link  href="https://github.com/angular-ui/bootstrap/blob/master/src/pagination/pagination.js">
<!-- jQuery library -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<!-- Latest compiled JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular-route.js"></script>

<link rel="stylesheet" type="text/css" href="css/layout.css">
<link rel="stylesheet" type="text/css" href="css/layout2.css">




<!-- tous les liens pour le Gantt-->

 <!-- <script src="http://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script> -->
  <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>

  <script src="gantt/libs/jquery/jquery.livequery.1.1.1.min.js"></script>
  <script src="gantt/libs/jquery/jquery.timers.js"></script>

  <script src="gantt/libs/utilities.js"></script>
  <script src="gantt/libs/forms.js"></script>
  <script src="gantt/libs/date.js"></script>
  <script src="gantt/libs/dialogs.js"></script>
  <script src="gantt/libs/layout.js"></script>
  <script src="gantt/libs/i18nJs.js"></script>
  <script src="gantt/libs/jquery/dateField/jquery.dateField.js"></script>
  <script src="gantt/libs/jquery/JST/jquery.JST.js"></script>

  <script type="text/javascript" src="gantt/libs/jquery/svg/jquery.svg.min.js"></script>
  <script type="text/javascript" src="gantt/libs/jquery/svg/jquery.svgdom.1.8.js"></script>


  <script src="gantt/ganttUtilities.js"></script>
  <script src="gantt/ganttTask.js"></script>
  <script src="gantt/ganttDrawerSVG.js"></script>
  <script src="gantt/ganttZoom.js"></script>
  <script src="gantt/ganttGridEditor.js"></script>
  <script src="gantt/ganttMaster.js"></script> 

  <link rel=stylesheet href="gantt/platform.css" type="text/css">
  <link rel=stylesheet href="gantt/libs/jquery/dateField/jquery.dateField.css" type="text/css">

  <link rel=stylesheet href="gantt/gantt.css" type="text/css">
  <link rel=stylesheet href="gantt/ganttPrint.css" type="text/css" media="print">
<!-- fin des liens pour le gantt-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script>
            // Get the modal
            $(function() {
                $('#id01').on('click', function(e) {
                    // Lorsque le formulaire est affiché, il s'estompe à la condition
                    // d'avoir un click à droite ou à gauche du formulaire. On fixe alors
                    // une position minimum et un maximum horizontale
                    var minwidth = ($(window).width() - $('#id01 form').width())/2;
                    var maxwidth = minwidth + $('#id01 form').width();
                    var minheight = ($(window).height() - $('#id01 form').height())/2;
                    var maxheight = minheight + $('#id01 form').height();
                    
                    if (e.pageX < minwidth || e.pageX > maxwidth || e.pageY<minheight || e.pageY>maxheight)
                        $('#id01').fadeOut(200);
                });
                $('#id02').on('click', function(e) {
                    // Lorsque le formulaire est affiché, il s'estompe à la condition
                    // d'avoir un click à droite ou à gauche du formulaire. On fixe alors
                    // une position minimum et un maximum horizontale
                    var minwidth = ($(window).width() - $('#id02 form').width())/2;
                    var maxwidth = minwidth + $('#id02 form').width();
                    var minheight = ($(window).height() - $('#id02 form').height())/2;
                    var maxheight = minheight + $('#id02 form').height();
                    
                    if (e.pageX < minwidth || e.pageX > maxwidth || e.pageY<minheight || e.pageY>maxheight)
                        $('#id02').fadeOut(200);
                });
            });
    </script>
    
    
    <script>
        //module principale de l'application
        var app = angular.module('myApp', ['ngRoute']);
                app.controller('MyCtrl', ['$scope', '$filter', function ($scope, $filter) {
                    $scope.currentPage = 0;
                    $scope.pageSize = 10;
                    $scope.data = [
                        ""
                    ];
                    $scope.q = '';
                    
                    $scope.getData = function () {
                        var arr = [];
                        if($scope.q == '') {
                            arr = $scope.data;
                        } else {
                            for(var ea in $scope.data) {
                                if($scope.data[ea].indexOf($scope.q) > -1) {
                                    arr.push( $scope.data[ea] );
                                }
                            }
                        }
                        return arr;
                   
                    }
                    
                    $scope.numberOfPages=function(){
                        return Math.ceil($scope.getData().length/$scope.pageSize);                
                    }
                    
                    /*for (var i=0; i<65; i++) {
                        $scope.data.push("Item "+i);
                    }*/
                }]);

                //We already have a limitTo filter built-in to angular,
                //let's make a startFrom filter
                app.filter('startFrom', function() {
                    return function(input, start) {
                        start = +start; //parse to int
                        return input.slice(start);
                    }
            });
            
            app.config(function($routeProvider) {
                $routeProvider
                .when("/", {
                    templateUrl : "main.html"
                })
                .when("/dashboard", {
                    templateUrl :"dashboard.html"
                })
                .otherwise({redirectTo : '/' });
            });
            
            //service de gestion de la session
            app.service('session', function($rootScope,$http) {
                
                //fonction pour connecter les utilisateur
                this.connect=function(emaillogin,pswlogin){
                    $http.post("/login",{email:emaillogin,psw:pswlogin})
                    .then (function success(data, status, headers, config) {
                       
                        if(data.data.success){
                            $rootScope.user=data.data.user;
                            window.location="#!dashboard"; 
                        }
                        else{
                            window.location="#!/";
                        }
                    },function eroor(data, status, headers, config) {
                    alert( "failure message: " + JSON.stringify({data: data}));
                     });
                }
                //vérifie si l'utilisateur est bien connecté
                this.islogged = function () {
                    $http.post("/issession")
                    .then(function success(data){
                        if(data.data.session){
                            $rootScope.user=data.data.user;
                        }
                        else{
                            window.location="#!/";
                        }
                    })
                }
                
                //fonction pour déconnecter les utilisateur
                this.deconnect=function(){
                    $http.post("/deconnexion")
                    .then(function success(data){
                        window.location="#!/";
                     })
                }
            });
            /*controller de connexion*/
            app.controller("CtrlConnection", function($scope,session) {
                $scope.login = function() {		
                    session.connect($scope.emaillogin,$scope.pswlogin);    
                }
            });

            /*controller du dashboard*/
            app.controller("dashCtrl",function($scope,session){
                $scope.check=function(){
                    session.islogged(); 
                }
                $scope.logout=function(){
                    session.deconnect();
                }
                $scope
            });

            app.controller("formCtrl",function($scope,$rootScope,$http){
                var currentTab = 0;
                $scope.initialisation=function(){
                    this.showTab(currentTab);
                }
                $scope.save=function(){
                    var projettosave={nom:$scope.nomproj,lieu:$scope.lieuproj,description:$scope.descriptionproj,user:$rootScope.user.email,};
                    var gantttosave = ge.saveGantt();
                    $http.post("/save",{projet:projettosave,gantt:gantttosave})
                    .then (function success(data, status, headers, config) {
                       
                        if(data.data.success){
                            alert("project sauvegarder"); 
                        }
                        else{
                            alert("une erreur est survenue");
                        }
                    },function eroor(data, status, headers, config) {
                    alert( "failure message: " + JSON.stringify({data: data}));
                     });
                }
                $scope.fixStepIndicator=function(n){
                    // This function removes the "active" class of all steps...
                    var i, x = document.getElementsByClassName("step");
                    for (i = 0; i < x.length; i++) {
                        x[i].className = x[i].className.replace(" active", "");
                    }
                    //... and adds the "active" class on the current step:
                    x[n].className += " active";
                }

                $scope.showTab = function(n){
                    // This function will display the specified tab of the form...
                    var x = document.getElementsByClassName("tab");
                    x[n].style.display = "block";
                    //... and fix the Previous/Next buttons:
                    if (n == 0) {
                        document.getElementById("prevBtn").style.display = "none";
                    } else {
                        document.getElementById("prevBtn").style.display = "inline";
                    }
                    if (n == (x.length - 1)) {
                        document.getElementById("nextBtn").innerHTML = "Submit";
                    } else {
                        document.getElementById("nextBtn").innerHTML = "Next";
                    }
                    //... and run a function that will display the correct step indicator:
                    this.fixStepIndicator(n);
                    $('#mainContent').hide().show(0);
                }

                $scope.nextPrev = function(n){
                    // This function will figure out which tab to display
                    var x = document.getElementsByClassName("tab");
                    // Exit the function if any field in the current tab is invalid:
                    if (n == 0 && !this.validateForm()) return false;
                    // Hide the current tab:
                    x[currentTab].style.display = "none";
                    // Increase or decrease the current tab by 1:
                    currentTab = currentTab + n;
                    // if you have reached the end of the form...
                    if (currentTab >= x.length) {
                        // ... the form gets submitted:
                        this.save();
                        this.clearfrom();
                        currentTab=0;this.showTab(0);
                        return false;
                    }
                    // Otherwise, display the correct tab:
                    this.showTab(currentTab);
                    //ge.splitter.resize(50);
                    //$("#50-split").click();
                    document.getElementById("50-split").click();
                    document.getElementById("edit-fictif").click();
                    document.getElementById("close-fictif").click();
                }

                $scope.validateForm = function(){
                    var x, y, i, valid = true;
                    x = document.getElementsByClassName("tab");
                    y = x[currentTab].getElementsByTagName("input");
                    // A loop that checks every input field in the current tab:
                    for (i = 0; i < y.length; i++) {
                        // If a field is empty...
                        if (y[i].value == "") {
                        // add an "invalid" class to the field:
                        y[i].className += " invalid";
                        // and set the current valid status to false
                        valid = false;
                        }
                    }
                    // If the valid status is true, mark the step as finished and valid:
                    if (valid) {
                        document.getElementsByClassName("step")[currentTab].className += " finish";
                    }
                    return valid; // return the valid status
                    }
                
                $scope.clearfrom = function(){
                        $scope.nomproj="";
                        $scope.lieuproj="";
                        $scope.descriptionproj="";
                        ge.reset();
                }

                    function fixStepIndicator(n) {
                    // This function removes the "active" class of all steps...
                    var i, x = document.getElementsByClassName("step");
                    for (i = 0; i < x.length; i++) {
                        x[i].className = x[i].className.replace(" active", "");
                    }
                    //... and adds the "active" class on the current step:
                    x[n].className += " active";
                }
            })
            </script>
            
    <title>Welcome</title>
</head>
<body ng-view>
       

</body>
</html>