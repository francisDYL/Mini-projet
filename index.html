<!DOCTYPE html>
<html lang="en" ng-app="myApp" >
<head>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
        
        <link  href="https://github.com/angular-ui/bootstrap/blob/master/src/pagination/pagination.js">
<!-- jQuery library -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<!-- Latest compiled JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular-route.js"></script>

<link rel="stylesheet" type="text/css" href="css/layout.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script>
            // Get the modal
            $(function() {
                $('#id01').on('click', function(e) {
                    // Lorsque le formulaire est affiché, il s'estompe à la condition
                    // d'avoir un click à droite ou à gauche du formulaire. On fixe alors
                    // une position minimum et un maximum horizontale
                    var minwidth = ($(window).width() - $('#id01 form').width())/2;
                    var maxwidth = minwidth + $('#id01 form').width();
                    var minheight = ($(window).height() - $('#id01 form').height())/2;
                    var maxheight = minheight + $('#id01 form').height();
                    
                    if (e.pageX < minwidth || e.pageX > maxwidth || e.pageY<minheight || e.pageY>maxheight)
                        $('#id01').fadeOut(200);
                });
                $('#id02').on('click', function(e) {
                    // Lorsque le formulaire est affiché, il s'estompe à la condition
                    // d'avoir un click à droite ou à gauche du formulaire. On fixe alors
                    // une position minimum et un maximum horizontale
                    var minwidth = ($(window).width() - $('#id02 form').width())/2;
                    var maxwidth = minwidth + $('#id02 form').width();
                    var minheight = ($(window).height() - $('#id02 form').height())/2;
                    var maxheight = minheight + $('#id02 form').height();
                    
                    if (e.pageX < minwidth || e.pageX > maxwidth || e.pageY<minheight || e.pageY>maxheight)
                        $('#id02').fadeOut(200);
                });
            });
    </script>
    
    
    <script>
        //module principale de l'application
        var app = angular.module('myApp', ['ngRoute']);
                app.controller('MyCtrl', ['$scope', '$filter', function ($scope, $filter) {
                    $scope.currentPage = 0;
                    $scope.pageSize = 10;
                    $scope.data = [
                        ""
                    ];
                    $scope.q = '';
                    
                    $scope.getData = function () {
                        var arr = [];
                        if($scope.q == '') {
                            arr = $scope.data;
                        } else {
                            for(var ea in $scope.data) {
                                if($scope.data[ea].indexOf($scope.q) > -1) {
                                    arr.push( $scope.data[ea] );
                                }
                            }
                        }
                        return arr;
                   
                    }
                    
                    $scope.numberOfPages=function(){
                        return Math.ceil($scope.getData().length/$scope.pageSize);                
                    }
                    
                    /*for (var i=0; i<65; i++) {
                        $scope.data.push("Item "+i);
                    }*/
                }]);

                //We already have a limitTo filter built-in to angular,
                //let's make a startFrom filter
                app.filter('startFrom', function() {
                    return function(input, start) {
                        start = +start; //parse to int
                        return input.slice(start);
                    }
            });
            
            app.config(function($routeProvider) {
                $routeProvider
                .when("/", {
                    templateUrl : "main.html"
                })
                .when("/dashboard", {
                    templateUrl :"dashboard.html"
                })
                .otherwise({redirectTo : '/' });
            });
            
            //service de gestion de la session
            app.service('session', function($rootScope,$http) {
                
                //fonction pour connecter les utilisateur
                this.connect=function(emaillogin,pswlogin){
                    $http.post("/login",{email:emaillogin,psw:pswlogin})
                    .then (function success(data, status, headers, config) {
                       
                        if(data.data.success){
                            $rootScope.user=data.data.user;
                            window.location="#!dashboard"; 
                        }
                        else{
                            window.location="#!/";
                        }
                    },function eroor(data, status, headers, config) {
                    alert( "failure message: " + JSON.stringify({data: data}));
                     });
                }
                //vérifie si l'utilisateur est bien connecté
                this.islogged = function () {
                    $http.post("/issession")
                    .then(function success(data){
                        if(data.data.session){
                            $rootScope.user=data.data.user;
                        }
                        else{
                            window.location="#!/";
                        }
                    })
                }
                
                //fonction pour déconnecter les utilisateur
                this.deconnect=function(){
                    $http.post("/deconnexion")
                    .then(function success(data){
                        window.location="#!/";
                     })
                }
            });
            app.controller("CtrlConnection", function($scope,session) {
                $scope.login = function() {		
                    session.connect($scope.emaillogin,$scope.pswlogin);    
                }
            });
            app.controller("dashCtrl",function($scope,session){
                $scope.check=function(){
                    session.islogged(); 
                }
                $scope.logout=function(){
                    session.deconnect();
                }
            })
            </script>
    <title>Welcome</title>
</head>
<body ng-view>
       

</body>
</html>